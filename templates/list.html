{% extends "base.html" %}

{% block title %}èª¿å‘³æ–™ä¸€è¦§ | ã¡ã‚‡ã¿ã¡ã‚‡ã¿{% endblock %}

{% block content %}
<section class="container">
  <h2>ç™»éŒ²æ¸ˆã¿èª¿å‘³æ–™ä¸€è¦§</h2>

  {% if condiments %}
  <div class="list-grid">
    {% for item in condiments %}
    <div class="item-card"
         data-id="{{ item.id }}"
         data-name="{{ item.name }}"
         data-image="{{ item.image_path or url_for('static', filename='noimage.png') }}"
         data-expiry="{{ item.expiry or '' }}"
         onclick="openModal(this)">
      <img src="{{ item.image_path or url_for('static', filename='noimage.png') }}" alt="{{ item.name }}">
      <div class="item-info">
        <p>{{ item.name }}</p>
        {% if item.expiry %}
        <p class="item-date">æœŸé™: {{ item.expiry }}</p>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p style="text-align:center; color:#555;">ã¾ã èª¿å‘³æ–™ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
  {% endif %}
</section>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="itemModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal()">&times;</span>
    <div class="modal-body">
      <img id="modalImage" src="" alt="">
      <h3 id="modalName"></h3>
      <p><strong>è³å‘³æœŸé™:</strong> <span id="modalExpiry"></span></p>
      <form id="deleteForm" method="post" class="delete-form">
        <button type="submit" onclick="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">ğŸ—‘ï¸ å‰Šé™¤</button>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const modal = document.getElementById("itemModal");
const modalImage = document.getElementById("modalImage");
const modalName = document.getElementById("modalName");
const modalExpiry = document.getElementById("modalExpiry");
const deleteForm = document.getElementById("deleteForm");

function openModal(card) {
  const { id, name, image, expiry } = card.dataset;
  modalName.textContent = name;
  modalImage.src = image;
  modalExpiry.textContent = expiry || "æœªè¨­å®š";
  deleteForm.action = `/delete/${id}`;
  modal.style.display = "block";
}

function closeModal() {
  modal.style.display = "none";
}

window.onclick = (e) => {
  if (e.target === modal) closeModal();
};
</script>
{% endblock %}
